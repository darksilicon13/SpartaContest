<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital@1&display=swap" rel="stylesheet">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@200&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300&display=swap" rel="stylesheet">
    <!-- jQuery    -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Infinite Scroll -->
    <script src="https://unpkg.com/infinite-scroll@4/dist/infinite-scroll.pkgd.min.js"></script>
    <!-- External CSS -->
    <link type="text/css" rel="stylesheet" href="../static/css/style.css">
    <!--파비콘-->
    <link rel="shortcut icon" type="image/x-icon" href="../static/img/favi2.png">
    <title>TToODLe</title>

    <script>

    </script>
</head>
<body>
<div class="wrapper">
    <div id="upperSide">
        <div class="toggleBox"><input type="checkbox" class="checkbox" id="checkbox"><label for="checkbox"
                                                                                            class="label">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun"></i>
            <div class="ball"></div>
        </label></div>
        <div id="slide"><a id="logo" href="/">
            <img src="../static/img/logologo.png">
        </a></div>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="0" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="login-tab" data-bs-toggle="tab"
                                    data-bs-target="#login" type="button" role="tab" aria-controls="login"
                                    aria-selected="true">Login
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="signup-tab" data-bs-toggle="tab"
                                    data-bs-target="#signup" type="button" role="tab"
                                    aria-controls="signup" aria-selected="false">Sign Up
                            </button>
                        </li>
                    </ul>
                    <div class="modal-body">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-logo-img"><img src="../static/img/footer_logo.png"></div>
                            <div class="tab-pane fade show active" id="login" role="tabpanel"
                                 aria-labelledby="login-tab"><h1 class="title">Login</h1>
                                <div id="logForm">
                                    <form>
                                        <div id="msg"></div>
                                        <div class="txt_field">
                                            <input type="email" name="email" class="email" required>
                                            <span></span>
                                            <label>email</label>
                                        </div>
                                        <div class="txt_field">
                                            <input type="password" name="password" class="password" required>
                                            <span></span>
                                            <label>Password</label>
                                        </div>
                                        <div class="pass">Forgot Password?</div>
                                        <button class="submit" value="Login" id="loginSubmit">login</button>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="signup" role="tabpanel"
                                 aria-labelledby="signup-tab"><h1 class="sub_title">Register</h1>
                                <div id="regForm">
                                    <form>
                                        <div id="email-warning"></div>
                                        <div class="txt_field">
                                            <input type="text" name="username" class="username" required>
                                            <span></span>
                                            <label>Username</label>
                                        </div>
                                        <div class="txt_field">
                                            <input type="email" name="email" class="email" required>
                                            <span></span>
                                            <label>Email</label>
                                        </div>
                                        <div class="txt_field">
                                            <input type="password" name="password" class="password" required>
                                            <span></span>
                                            <label>Password</label>
                                        </div>
                                        <div class="txt_field">
                                            <input type="password" name="conformPassword" class="confirmPassword"
                                                   required>
                                            <span></span>
                                            <label>Confirm Pasword</label>
                                        </div>
                                        <button class="submit" id="registerSubmit">Register</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="waviy">
            <span style="--i:1" class="waviyW">S</span>
            <span style="--i:2" class="waviyH">C</span>
            <span style="--i:3" class="waviyE">R</span>
            <span style="--i:4" class="waviyR">O</span>
            <span style="--i:5" class="waviyE">L</span>
            <span style="--i:6" class="waviyR1">L</span>
            <span style="--i:7" class="waviyU">D</span>
            <span style="--i:8" class="waviyG">O</span>
            <span style="--i:9" class="waviyO">W</span>
            <span style="--i:10" class="waviyW">N</span>
            <span style="--i:12" class="waviyR">⬇︎</span>
        </div>
        <div id="searchBox">
            <div id="search">
                <form class="searchForm">
                    <div class="searchBar">
                        <input id="genreInput" type="text" placeholder="Search for the keyword . . 🫠">
                        <span></span>
                        <label id="searchShop">#</label>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="toggle"></div>
    <div id="sidebar">
        <ul>
            <li id="loggedIn"></li>
            <li><a id="loginButton" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Login
            </a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/customer_request">Request</a></li>
            <li><a href="/feedback">Feedback</a></li>
        </ul>
    </div>
    <div id="genre">
        <a onclick="filterObjects('all'); genreAppend()" class="genreBtn" value="Dog"><img src="../static/img/all.png"></a>
        <a onclick="filterObjects('고양이'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/animal.png"></a>
        <a onclick="filterObjects('Vlog'); genreAppend()" class="genreBtn" value="Show All"><img
                src="../static/img/pudding.png"></a>
        <a onclick="filterObjects('영화'); genreAppend()" class="genreBtn" value="Cat"><img
                src="../static/img/film_1.png"></a>
        <a onclick="filterObjects('음악'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/music.png"></a>
        <a onclick="filterObjects('여행'); genreAppend()" class="genreBtn" value="Dog"><img
                src="../static/img/travel.png"></a>
        <a onclick="filterObjects('ASMR'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/ASMR.png"></a>
        <a onclick="filterObjects('FUN'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/fun_1.png"></a>
    </div>
    <div class="videoList">
        <table class="table">
            <tr id="movielist">
            </tr>
        </table>
    </div>
    <div class="loader-ellips">
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
    </div>
</div>
<footer class="footer">
    <div class="footer-logo"><a id="footerlink1" href="/"><img class="footer-logo-img"
                                                               src="../static/img/footer_logo.png"></a>
        <div id="footerIcon">
            <a id="footerlink2" href="http://www.instagram.com/ttoodle.io" target='_blank'>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                     class="bi bi-instagram" viewBox="0 0 16 16">
                    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"/>
                </svg>
                <a id="footerlink3" href="https://github.com/darksilicon13/SpartaContest" target='_blank'>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" class="bi bi-github"
                         viewBox="0 0 16 16">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                </a>
                <a id="footerlink4" href="https://spartacodingclub.kr" target='_blank'><img
                        src="../static/img/sparta.png"></a>
            </a></div>
    </div>

    <div class="footer-contents">
        <div class="footer-fe-box">
            <div><h3 class="poppinsFont">Frontend</h3></div>
            <div class="footer-name">
                <ul>최준묵</ul>
                <a href="https://github.com/dan-studio" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
            </div>
            <div class="footer-name">
                <ul>노지애</ul>
                <div><a href="https://github.com/jiaero" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
                </div>
            </div>
            <div class="footer-name">
                <ul>이현규</ul>
                <icon><a href="https://github.com/darksilicon13" target="_blank"><i
                        class="fa-brands fa-github fa-lg"></i></a>
                </icon>
            </div>
            <div class="footer-name">
                <ul>이정민</ul>
                <icon><a href="https://github.com/froggy1014" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
                </icon>
            </div>
        </div>
        <div class="footer-bett-box">
            <div class="footer-be-box">
                <h3 class="poppinsFont">Backend</h3>
                <div class="footer-name">
                    <ul>전가영</ul>
                    <icon><a href="https://github.com/dsyhwk1016" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
                <div class="footer-name">
                    <ul>송기찬</ul>
                    <icon><a href="https://github.com/gichan-song" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
            </div>
            <div class="division"></div>
            <div class="footer-be-box">
                <h3 class="poppinsFont">tutor</h3>
                <div class="footer-name">
                    <ul>최영서</ul>
                    <icon><a href="https://github.com/tomatophobia" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
            </div>
        </div>
        <div class="footer-searchbar">
            <div class="input-group mb-3">
                <input type="text" class="form-control poppinsFont" placeholder="Quick-Search"
                       aria-label="Recipient's username"
                       aria-describedby="button-addon2" onkeyup="if(window.event.keyCode==13){youtube(this.value)}">
                <button class="btn btn-outline-secondary poppinsFont" type="button" id="button-addon2">go ▸


                </button>
            </div>
            <div class="footer-about">
                <a href="/">Home</a>
                <a href="/about">About</a>
                <a href="https://www.notion.so/2-3be792a4fe0c40388a1474532f4c5328" target="_blank">Team Notion</a>

                <a href="#"></a>
            </div>
        </div>
    </div>
    <div class="footer-copy2"><p>Copyright © 2022 TToODLe Team. All rights reserved.</p></div>
</footer>
</body>
<script>
    // main.html로 왔을때 다시 로컬스토리지 클리어
    window.onload = window.localStorage.clear();

    document.addEventListener("DOMContentLoaded", () => {
        let options = {
            root: null,
            rootMargins: "0px", //마진 없음
            threshold: 0.5 //footer가 50% 보여지면 동작
        };
        const observer = new IntersectionObserver(handleIntersect, options);
        observer.observe(document.querySelector("footer")) //footer 발견 시 handleIntersect 함수 실행
        getData();
        if (getCookie('token') != null) {
            const logoutButton = `<a id="logoutButton" type="button" onclick="logout()">Logout</a>`
            $('#loginButton').replaceWith(logoutButton) //로그인 되면 해당 버튼 로그아웃으로 변경
            const username = sessionStorage.getItem('username')
            const loggedInMessage = `<li id="loggedIn">${username} 님 환영합니다 🥰</li>`
            $('#loggedIn').replaceWith(loggedInMessage)
        }
    })

    function handleIntersect(entries) {
        if (entries[0].isIntersecting) {
            console.warn('footer  on  screen!!')
            setTimeout(() => {
                getData()
            }, 1000)//로딩시 1초 지연
        }
    }

    let cnt = 0;

    function getData() {
        let main = document.querySelector('#movielist');
        console.log('fetch some JSON data')
        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "/data",
                data: {},
                success: function (response) {
                    if (sessionStorage.getItem("category") == "all") {
                        cnt = counting(cnt)
                        let dbjson = response["msg"];
                        for (i = cnt; i < cnt + 8; i++) {
                            channel = dbjson[i]["채널명"];
                            keyword = dbjson[i]["키워드"];
                            thumbnail = dbjson[i]["썸네일"];
                            youtubericon = dbjson[i]["유튜버아이콘"];
                            temp_html_td = `
            <td onclick='getValue(${i})' class="videoBox show ${keyword}">
                    <div class="videoDiv">
                        <a class="thumbnail">
                            <img src=${thumbnail}>
                        </a>
                    </div>
                    <div class="videoText">
                        <a class="thumbnail"><img class="channelImg" id=${i}
                                                  src=${youtubericon}><name
                                class="name">${channel}</name></a>
                    </div>
                </td>`;
                            $("#movielist").append(temp_html_td);
                        }
                        sessionStorage.setItem("start", "1");
                    } else {
                        if (sessionStorage.getItem("filterCnt") !== "done") {
                            let c = sessionStorage.getItem("category")
                            let dbjson = response["msg"];
                            let count = 0;
                            for (let k = 0; k < 200; k++) {
                                keyword = dbjson[k]["키워드"];
                                if (keyword === c) {
                                    channel = dbjson[k]["채널명"];
                                    keyword = dbjson[k]["키워드"];
                                    thumbnail = dbjson[k]["썸네일"];
                                    youtubericon = dbjson[k]["유튜버아이콘"];
                                    temp_html_td = `
                                                <td onclick='getValue(${k})' class="videoBox show ${keyword}">
                                                    <div class="videoDiv">
                                                        <a class="thumbnail">
                                                        <img src=${thumbnail}>
                                                    </a>
                                                    </div>
                                                    <div class="videoText">
                                                        <a class="thumbnail"><img class="channelImg" id=${k}
                                                                                 src=${youtubericon}><name
                                                                class="name">${channel}</name></a>
                                                    </div>
                                                </td>`;
                                    $("#movielist").append(temp_html_td);
                                }
                            }
                            sessionStorage.setItem("filterCnt", "done");
                        } else if (sessionStorage.getItem("filterCnt") === "done") return;

                    }
                },
            });
        });
    }

    function counting(n) {
        if (sessionStorage.getItem('start') !== "1") {
            let cnt = n;
            return cnt;
        } else {
            let cnt = n + 8;
            return cnt;
        }
    }

    function getValue(id) {
        $.ajax({
            type: "GET",
            url: "/data",
            data: {},
            success: function (response) {
                let dbjson = response['msg']
                sessionStorage.setItem('channel', dbjson[id]['채널명'])
                sessionStorage.setItem('you', dbjson[id]['유튜버아이콘'])
                window.location.href = "/playlist";
            }
        })
    };
    toggle.onclick = function () {
        toggle.classList.toggle('active');
        sidebar.classList.toggle('active');
    }
    document.onclick = function (e) {
        if (e.target.id !== 'sidebar' && e.target.id !== 'toggle') {
            toggle.classList.remove('active')
            sidebar.classList.remove('active')
        }
    }
    const searchbtn = document.getElementById("button-addon2");
    const searchinput = document.querySelector(".form-control");

    searchbtn.addEventListener('click', () => {
        youtube(searchinput.value);
    })

    function youtube(value) {
        if (!value) {
            window.open("https://www.youtube.com");
            return;
        }
        window.open("https://www.youtube.com/results?search_query=" + value);
        searchinput.value = "";
    }

    filterObjects("all");

    function filterObjects(c) {
        var x, i;
        x = document.getElementsByClassName("videoBox");
        sessionStorage.removeItem("filterCnt");
        sessionStorage.setItem("category", c);

        if (x.length < 100) {
            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: "/data",
                    data: {},
                    success: function (response) {
                        let dbjson = response["msg"];
                        let count = 0;
                        for (let k = 0; k < 200; k++) {
                            keyword = dbjson[k]["키워드"];
                            if (keyword === c) {

                                channel = dbjson[k]["채널명"];
                                keyword = dbjson[k]["키워드"];
                                thumbnail = dbjson[k]["썸네일"];
                                youtubericon = dbjson[k]["유튜버아이콘"];
                                temp_html_td = `
                                            <td onclick='getValue(${k})' class="videoBox show ${keyword}">
                                                <div class="videoDiv">
                                                    <a class="thumbnail">
                                                    <img src=${thumbnail}>
                                                </a>
                                                </div>
                                                <div class="videoText">
                                                    <a class="thumbnail"><img class="channelImg" id=${k}
                                                                             src=${youtubericon}><name
                                                            class="name">${channel}</name></a>
                                                </div>
                                            </td>`;
                                $("#movielist").append(temp_html_td);

                            }
                            count++
                            if (count > 8) break;
                        }
                    },
                });
            });
        }
        if (c == "all") {
            c = "";
        }

        for (i = 0; i < x.length; i++) {
            removeClass(x[i], "show");
            if (x[i].className.indexOf(c) > -1) {
                addClass(x[i], "show");
            }
        }
    }

    function addClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            if (arr1.indexOf(arr2[i]) == -1) {
                element.className += " " + arr2[i];
            }
        }
    }

    function removeClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            while (arr1.indexOf(arr2[i]) > -1) {
                arr1.splice(arr1.indexOf(arr2[i]), 1);
            }
        }
        element.className = arr1.join(" ");
    }

    //스크롤시 색상 변경
    $(document).ready(function () {
        $(window).scroll(function () {
            $('#upperSide').css("opacity", 1 - $(window).scrollTop() / 500)
        })
    })
</script>
<script src="../static/javascript/darkmode.js"></script>
<script src="../static/javascript/login.js"></script>
</html>