<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital@1&display=swap" rel="stylesheet">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@200&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <!-- jQuery    -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Infinite Scroll -->
    <script src="https://unpkg.com/infinite-scroll@4/dist/infinite-scroll.pkgd.min.js"></script>
    <!-- External CSS -->
    <link type="text/css" rel="stylesheet" href="../static/css/style.css">
    <!--ÌååÎπÑÏΩò-->
    <link rel="shortcut icon" type="image/x-icon" href="../static/img/favi2.png">
    <title>TToODLe</title>

    <script>

    </script>
</head>
<body>
<div class="wrapper">
    <div id="upperSide">
        <div class="toggleBox"><input type="checkbox" class="checkbox" id="checkbox"><label for="checkbox"
                                                                                            class="label">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun"></i>
            <div class="ball"></div>
        </label></div>
        <div id="slide"><a id="logo" href="/">
            <img src="../static/img/logologo.png">
        </a></div>
        <div id="toggle"></div>
        <div id="sidebar">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/user">Login</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/customer_request">Request</a></li>
                <li><a href="/contact">Contact</a></li>
            </ul>
        </div>
        <div class="waviy">
            <span style="--i:1" class="waviyW">W</span>
            <span style="--i:2" class="waviyH">h</span>
            <span style="--i:3" class="waviyE">e</span>
            <span style="--i:4" class="waviyR">r</span>
            <span style="--i:5" class="waviyE">e</span>
            <span style="--i:6" class="waviyR1">R</span>
            <span style="--i:7" class="waviyU">U</span>
            <span style="--i:8" class="waviyG">g</span>
            <span style="--i:9" class="waviyO">o</span>
            <span style="--i:10" class="waviyQ">?</span>
        </div>
        <div id="searchBox">
            <div id="search">
                <div class="searchForm">
                    <div class="searchBar">
                        <input id="genreInput" type="text" placeholder="Search for the keyword . . ü´†">
                        <span></span>
                        <label id="searchShop">#</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="genre">
        <a onclick="filterObjects('all'); genreAppend()" class="genreBtn" value="Dog"><img src="../static/img/all.png"></a>
        <a onclick="filterObjects('Í≥†ÏñëÏù¥'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/animal.png"></a>
        <a onclick="filterObjects('Vlog'); genreAppend()" class="genreBtn" value="Show All"><img
                src="../static/img/pudding.png"></a>
        <a onclick="filterObjects('ÏòÅÌôî'); genreAppend()" class="genreBtn" value="Cat"><img
                src="../static/img/film_1.png"></a>
        <a onclick="filterObjects('ÏùåÏïÖ'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/music.png"></a>
        <a onclick="filterObjects('Ïó¨Ìñâ'); genreAppend()" class="genreBtn" value="Dog"><img
                src="../static/img/travel.png"></a>
        <a onclick="filterObjects('ASMR'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/ASMR.png"></a>
        <a onclick="filterObjects('FUN'); genreAppend()" class="genreBtn" value="Series"><img
                src="../static/img/fun_1.png"></a>
    </div>
    <div class="videoList">
        <table class="table">
            <tr id="movielist">
            </tr>
        </table>
    </div>
    <div class="loader-ellips">
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
        <span class="loader-ellips__dot"></span>
    </div>
</div>
<footer class="footer">
    <div class="footer-logo"><img class="footer-logo-img" src="../static/img/footer_logo.png"></div>
    <div class="footer-contents">
        <div class="footer-fe-box">
            <div><h3 class="poppinsFont">Front-End</h3></div>
            <div class="footer-name">
                <ul>ÏµúÏ§ÄÎ¨µ</ul>
                <a href="https://github.com/dan-studio" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
            </div>
            <div class="footer-name">
                <ul>ÎÖ∏ÏßÄÏï†</ul>
                <div><a href="https://github.com/jiaero" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
                </div>
            </div>
            <div class="footer-name">
                <ul>Ïù¥ÌòÑÍ∑ú</ul>
                <icon><a href="https://github.com/darksilicon13" target="_blank"><i
                        class="fa-brands fa-github fa-lg"></i></a>
                </icon>
            </div>
            <div class="footer-name">
                <ul>Ïù¥Ï†ïÎØº</ul>
                <icon><a href="https://github.com/froggy1014" target="_blank"><i class="fa-brands fa-github fa-lg"></i></a>
                </icon>
            </div>
        </div>
        <div class="footer-bett-box">
            <div class="footer-be-box">
                <h3 class="poppinsFont">Back-End</h3>
                <div class="footer-name">
                    <ul>Ï†ÑÍ∞ÄÏòÅ</ul>
                    <icon><a href="https://github.com/dsyhwk1016" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
                <div class="footer-name">
                    <ul>ÏÜ°Í∏∞Ï∞¨</ul>
                    <icon><a href="https://github.com/gichan-song" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
            </div>
            <div class="division"></div>
            <div class="footer-be-box">
                <h3 class="poppinsFont">tutor</h3>
                <div class="footer-name">
                    <ul>ÏµúÏòÅÏÑú</ul>
                    <icon><a href="https://github.com/tomatophobia" target="_blank"><i
                            class="fa-brands fa-github fa-lg"></i></a>
                    </icon>
                </div>
            </div>
        </div>
        <div class="footer-searchbar">
            <div class="input-group mb-3">
                <input type="text" class="form-control poppinsFont" placeholder="Quick-Search"
                       aria-label="Recipient's username"
                       aria-describedby="button-addon2" onkeyup="if(window.event.keyCode==13){youtube(this.value)}">
                <button class="btn btn-outline-secondary poppinsFont" type="button" id="button-addon2">go ‚ñ∏


                </button>
            </div>
            <div class="footer-about">
                <a href="main.html">Home</a>
                <a href="#">About</a>
                <a href="https://www.notion.so/2-3be792a4fe0c40388a1474532f4c5328" target="_blank">Team Notion</a>
                <a href="#"></a>
                <a href="#"></a>
            </div>
        </div>
    </div>
    <div class="footer-copy"><p class="poppinsFont">Copyright ¬© 2022 TToODLe Team. All rights reserved.</p></div>
</footer>
</body>
<script>
    // main.htmlÎ°ú ÏôîÏùÑÎïå Îã§Ïãú Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ ÌÅ¥Î¶¨Ïñ¥
    window.onload = window.localStorage.clear();

    document.addEventListener("DOMContentLoaded", () => {
        let options = {
            root: null,
            rootMargins: "0px", //ÎßàÏßÑ ÏóÜÏùå
            threshold: 0.5 //footerÍ∞Ä 50% Î≥¥Ïó¨ÏßÄÎ©¥ ÎèôÏûë
        };
        const observer = new IntersectionObserver(handleIntersect, options);
        observer.observe(document.querySelector("footer")) //footer Î∞úÍ≤¨ Ïãú handleIntersect Ìï®Ïàò Ïã§Ìñâ
        getData();
    })

    function handleIntersect(entries) {
        if (entries[0].isIntersecting) {
            console.warn('footer  on  screen!!')
            getData();
        }
    }

    let cnt = 0;

    function getData() {
        let main = document.querySelector('#movielist');
        console.log('fetch some JSON data')
        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "/data",
                data: {},
                success: function (response) {
                    if (sessionStorage.getItem("category") == "all") {
                        cnt = counting(cnt)
                        let dbjson = response["msg"];
                        for (i = cnt; i < cnt + 8; i++) {
                            channel = dbjson[i]["Ï±ÑÎÑêÎ™Ö"];
                            keyword = dbjson[i]["ÌÇ§ÏõåÎìú"];
                            thumbnail = dbjson[i]["Ïç∏ÎÑ§Ïùº"];
                            youtubericon = dbjson[i]["Ïú†ÌäúÎ≤ÑÏïÑÏù¥ÏΩò"];
                            temp_html_td = `
            <td onclick='getValue(${i})' class="videoBox show ${keyword}">
                    <div class="videoDiv">
                        <a class="thumbnail">
                            <img src=${thumbnail}>
                        </a>
                    </div>
                    <div class="videoText">
                        <a class="thumbnail"><img class="channelImg" id=${i}
                                                  src=${youtubericon}><name
                                class="name">${channel}</name></a>
                    </div>
                </td>`;
                            $("#movielist").append(temp_html_td);
                        }
                        sessionStorage.setItem("start", "1");
                    } else {
                        if (sessionStorage.getItem("filterCnt") !== "done") {
                            let c = sessionStorage.getItem("category")
                            let dbjson = response["msg"];
                            let count = 0;
                            for (let k = 0; k < 200; k++) {
                                keyword = dbjson[k]["ÌÇ§ÏõåÎìú"];
                                if (keyword === c) {
                                    channel = dbjson[k]["Ï±ÑÎÑêÎ™Ö"];
                                    keyword = dbjson[k]["ÌÇ§ÏõåÎìú"];
                                    thumbnail = dbjson[k]["Ïç∏ÎÑ§Ïùº"];
                                    youtubericon = dbjson[k]["Ïú†ÌäúÎ≤ÑÏïÑÏù¥ÏΩò"];
                                    temp_html_td = `
                                                <td onclick='getValue(${k})' class="videoBox show ${keyword}">
                                                    <div class="videoDiv">
                                                        <a class="thumbnail">
                                                        <img src=${thumbnail}>
                                                    </a>
                                                    </div>
                                                    <div class="videoText">
                                                        <a class="thumbnail"><img class="channelImg" id=${k}
                                                                                 src=${youtubericon}><name
                                                                class="name">${channel}</name></a>
                                                    </div>
                                                </td>`;
                                    $("#movielist").append(temp_html_td);
                                }
                            }
                            sessionStorage.setItem("filterCnt", "done");
                        } else if (sessionStorage.getItem("filterCnt") === "done") return;

                    }
                },
            });
        });
    }

    function counting(n) {
        if (sessionStorage.getItem('start') !== "1") {
            let cnt = n;
            return cnt;
        } else {
            let cnt = n + 8;
            return cnt;
        }
    }

    function getValue(id) {
        $.ajax({
            type: "GET",
            url: "/data",
            data: {},
            success: function (response) {
                let dbjson = response['msg']
                localStorage.setItem('channel', dbjson[id]['Ï±ÑÎÑêÎ™Ö'])
                sessionStorage.setItem('you', dbjson[id]['Ïú†ÌäúÎ≤ÑÏïÑÏù¥ÏΩò'])
                window.location.href = "/playlist";
            }
        })
    };
    toggle.onclick = function () {
        toggle.classList.toggle('active');
        sidebar.classList.toggle('active');
    }
    document.onclick = function (e) {
        if (e.target.id !== 'sidebar' && e.target.id !== 'toggle') {
            toggle.classList.remove('active')
            sidebar.classList.remove('active')
        }
    }
    const searchbtn = document.getElementById("button-addon2");
    const searchinput = document.querySelector(".form-control");
    const searchkey = document.getElementById('genreInput')

    searchbtn.addEventListener('click', () => {
        youtube(searchinput.value);
    })
    searchkey.addEventListener('keyup', (e) => {
        if (e.key == 'Enter') {
            var x, i;
            x = document.getElementsByClassName("videoBox");
            for (i = 0; i < x.length; i++) {
                removeClass(x[i], "show");
            }
            $.ajax({
                type: "GET",
                url: "/search?input=" + searchkey.value,
                data: {},
                success: function (response) {
                    let dbjson = response['msg']
                    for (let i = dbjson.length - 1; i > -1; i--) {
                        // console.log(response['msg'][i]['Ï±ÑÎÑêÎ™Ö'])
                        channel = dbjson[i]["Ï±ÑÎÑêÎ™Ö"];
                        keyword = dbjson[i]["ÌÇ§ÏõåÎìú"];
                        thumbnail = dbjson[i]["Ïç∏ÎÑ§Ïùº"];
                        youtubericon = dbjson[i]["Ïú†ÌäúÎ≤ÑÏïÑÏù¥ÏΩò"];
                        temp_html_td = `
                                            <td onclick='getValue(${i})' class="videoBox show ${keyword}">
                                                <div class="videoDiv">
                                                    <a class="thumbnail">
                                                    <img src=${thumbnail}>
                                                </a>
                                                </div>
                                                <div class="videoText">
                                                    <a class="thumbnail"><img class="channelImg" id=${i}
                                                                             src=${youtubericon}><name
                                                            class="name">${channel}</name></a>
                                                </div>
                                            </td>`;
                        $("#movielist").append(temp_html_td);


                    }
                }
            })
        }
    })

    function youtube(value) {
        if (!value) {
            window.open("https://www.youtube.com");
            return;
        }
        window.open("https://www.youtube.com/results?search_query=" + value);
        searchinput.value = "";
    }

    filterObjects("all");

    function filterObjects(c) {
        var x, i;
        x = document.getElementsByClassName("videoBox");
        sessionStorage.removeItem("filterCnt");
        sessionStorage.setItem("category", c);

        if (x.length < 100) {
            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: "/data",
                    data: {},
                    success: function (response) {
                        let dbjson = response["msg"];
                        let count = 0;
                        for (let k = 0; k < 200; k++) {
                            keyword = dbjson[k]["ÌÇ§ÏõåÎìú"];
                            if (keyword === c) {

                                channel = dbjson[k]["Ï±ÑÎÑêÎ™Ö"];
                                keyword = dbjson[k]["ÌÇ§ÏõåÎìú"];
                                thumbnail = dbjson[k]["Ïç∏ÎÑ§Ïùº"];
                                youtubericon = dbjson[k]["Ïú†ÌäúÎ≤ÑÏïÑÏù¥ÏΩò"];
                                temp_html_td = `
                                            <td onclick='getValue(${k})' class="videoBox show ${keyword}">
                                                <div class="videoDiv">
                                                    <a class="thumbnail">
                                                    <img src=${thumbnail}>
                                                </a>
                                                </div>
                                                <div class="videoText">
                                                    <a class="thumbnail"><img class="channelImg" id=${k}
                                                                             src=${youtubericon}><name
                                                            class="name">${channel}</name></a>
                                                </div>
                                            </td>`;
                                $("#movielist").append(temp_html_td);

                            }
                            count++
                            if (count > 8) break;
                        }
                    },
                });
            });
        }
        if (c == "all") {
            c = "";
        }

        for (i = 0; i < x.length; i++) {
            removeClass(x[i], "show");
            if (x[i].className.indexOf(c) > -1) {
                addClass(x[i], "show");
            }
        }
    }

    function addClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            if (arr1.indexOf(arr2[i]) == -1) {
                element.className += " " + arr2[i];
            }
        }
    }

    function removeClass(element, name) {
        var i, arr1, arr2;
        arr1 = element.className.split(" ");
        arr2 = name.split(" ");
        for (i = 0; i < arr2.length; i++) {
            while (arr1.indexOf(arr2[i]) > -1) {
                arr1.splice(arr1.indexOf(arr2[i]), 1);
            }
        }
        element.className = arr1.join(" ");
    }

    //Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú ÏûÖÎ†•Ï∞ΩÏóê Ìï¥Îãπ Í∞í ÎÑ£Í∏∞
    function genreAppend() {
        const btnVal = $('.genreBtn').val();
        $('#genreInput').val(btnVal)
    }

</script>
<script src="../static/javascript/darkmode.js"></script>
<script src="../static/javascript/infScroll.js.js"></script>
</html>